D2L.Control.Grid=D2L.Control.extend({Construct:function(){arguments.callee.$.Construct.call(this);this.nameOrMappedId='';this.type=D2L.Control.Grid.Type.Data;this.activatedKey='';this.pageNum=1;this.pageSize=20;this.sortField='';this.sortDir=1;this.sortFieldForState='';this.sortDirForState=1;this.isUsingDefaultSort=false;this.search=null;this.m_selectionAllowMultiple=true;this.m_treeType=null;this.m_slPgSz1=null;this.m_slPgSz2=null;this.m_slPgNm1=null;this.m_slPgNm2=null;this.m_treeRowsExpanded=true;this.m_treeRowExceptionKeys=[];this.m_isSelectedExceptionKeys=[];this.m_rowIndex=1;this.OnSelectRow=new D2L.EventHandler();this.OnDeleteRow=new D2L.EventHandler();this.OnRestoreRow=new D2L.EventHandler();this.OnPageNumberChange=new D2L.EventHandler();this.OnPageSizeChange=new D2L.EventHandler();WindowEventManager.Transform.Register(this,'RefreshItemRowTrees');Nav.OnBeforeNavigate.Register(this,'OnNav');},IntegrateControlMin:function(deserializer){arguments.callee.$.IntegrateControlMin.call(this,deserializer);this.type=deserializer.GetMember();this.isUsingDefaultSort=deserializer.GetBoolean();this.pageNum=deserializer.GetMember();this.pageSize=deserializer.GetMember();this.m_treeType=deserializer.GetMember();this.m_selectionAllowMultiple=deserializer.GetBoolean();this.sortField=deserializer.GetMember();this.sortDir=deserializer.GetMember();this.m_treeRowsExpanded=deserializer.GetBoolean();this.m_treeRowExceptionKeys=deserializer.GetDictionaryMin();this.m_isSelectedExceptionKeys=deserializer.GetDictionaryMin();this.data=deserializer.GetMember();this.m_rowIndex=deserializer.GetMember();var activatedKey=deserializer.GetMember();this.nameOrMappedId=deserializer.GetMember();this.m_slPgSz1=UI.GetControl(this.GetMappedId()+'_sl_pgS1');this.m_slPgSz2=UI.GetControl(this.GetMappedId()+'_sl_pgS2');this.m_slPgNm1=UI.GetControl(this.GetMappedId()+'_sl_pg1');this.m_slPgNm2=UI.GetControl(this.GetMappedId()+'_sl_pg2');this.Init();if(activatedKey.length>0){this.Activate(activatedKey);}},GetTreeRowsExpanded:function(){return this.m_treeRowsExpanded;},GetTreeExceptionKeys:function(){return this.m_treeRowExceptionKeys;},GetTreeExceptionKeysForState:function(){var ret=new Array();var me=this;this.ForEachRow(function(currRow){if(currRow.type=='i'&&currRow.isTreeNode){var key=currRow.GetKey();var defExpanded=me.GetTreeRowsExpanded();if(me.GetTreeExceptionKeys()[key]){if(currRow.isExpanded==defExpanded){ret[ret.length]=key;}}else{if(currRow.isExpanded!=defExpanded){ret[ret.length]=key;}}}});return ret;},GetCollapsedKeys:function(){var ret=new Array();var me=this;this.ForEachRow(function(currRow){if(currRow.type=='i'&&currRow.isTreeNode){var key=currRow.GetKey();if(currRow.isExpanded==false){ret[ret.length]=key;}}});return ret;},GetExpandedKeys:function(){var ret=new Array();var me=this;this.ForEachRow(function(currRow){if(currRow.type=='i'&&currRow.isTreeNode){var key=currRow.GetKey();if(currRow.isExpanded==true){ret[ret.length]=key;}}});return ret;},GetIsSelectedExceptionKeys:function(){return this.m_isSelectedExceptionKeys;},GetIsSelectedExceptionKeysForState:function(){var ret=new Array();var me=this;this.ForEachRow(function(currRow){if(currRow.type=='i'){var isSelected=currRow.IsSelected();var key=currRow.GetKey();if(me.GetIsSelectedExceptionKeys()[key]){if(!isSelected){ret[ret.length]=key;}}else{if(isSelected){ret[ret.length]=key;}}}});return ret;},GetSelectedGroupKeys:function(){return this.GetSelectedKeysForType('g');},GetSelectedKeys:function(){return this.GetSelectedKeysForType('i');},RefreshItemRowTrees:function(){var currRow,currKey;if(this.rowData&&this.rowData.allRows){for(currKey in this.rowData.allRows){currRow=this.rowData.allRows[currKey];}}},GetSelectedValues:function(){var ret=new Array();var currKey,currRow;if(this.rowData&&this.rowData.allRows){for(currKey in this.rowData.allRows){currRow=this.rowData.allRows[currKey];if(currRow.type=='i'&&currRow.IsSelected()){ret.push(currRow.val);}}}return ret;},GetKeys:function(){var underScoreIndex=-1;var ret=new Array();var currKey,currRow;if(this.rowData&&this.rowData.allRows){for(currKey in this.rowData.allRows){currRow=this.rowData.allRows[currKey];if(currRow.type=='i'){underScoreIndex=currKey.indexOf('_');if(underScoreIndex>=0&&underScoreIndex<currKey.length){currKey=currKey.substr(underScoreIndex+1);}ret.push(currKey);}}}return ret;},GetState:function(serializer,stateType,key){if(stateType=='rowshowchanges'){var row=this.GetRow(key);if(row!==null){var changedCells='';for(var i=0;i<row.obj.cells.length;i++){changedCells+=row.changedCells[i]?'1':'0';}serializer.AddMember('HasChanged',row.hasChanged);serializer.AddMember('ChangedCells',changedCells);}}else if(stateType=='pagenum'){serializer.AddMember('PageNum',this.pageNum);}else if(stateType=='tree'){serializer.AddMember('ExceptionKeys',this.GetTreeExceptionKeysForState());}else if(stateType=='rows'){serializer.AddMember('ActivatedKey',this.GetActivatedKey());serializer.AddMember('ExceptionKeys',this.GetIsSelectedExceptionKeysForState());}else{serializer.AddMember('PageSize',this.pageSize);if(this.isUsingDefaultSort){serializer.AddMember('SortField',this.sortFieldForState);serializer.AddMember('SortDir',this.sortDirForState);}else{serializer.AddMember('SortField',this.sortField);serializer.AddMember('SortDir',this.sortDir);}if(this.search){serializer.AddMember('IsSearchExpanded',this.search.GetIsExpanded());}}},GetValues:function(){var ret=new Array();var currKey,currRow;if(this.rowData&&this.rowData.allRows){for(currKey in this.rowData.allRows){currRow=this.rowData.allRows[currKey];if(currRow.type=='i'){ret.push(currRow.val);}}}return ret;},GetGroupSelectedKeys:function(){return this.GetSelectedGroupKeys();},GetGroupKeys:function(){var underScoreIndex=-1;var ret=new Array();var currKey,currRow;if(this.rowData&&this.rowData.allRows){for(currKey in this.rowData.allRows){currRow=this.rowData.allRows[currKey];if(currRow.type=='g'){underScoreIndex=currKey.indexOf('_');if(underScoreIndex>=0&&underScoreIndex<currKey.length){currKey=currKey.substr(underScoreIndex+1);}ret.push(currKey);}}}return ret;},GetRowsByValue:function(value){var ret=new Array();var currKey,currRow;if(this.rowData&&this.rowData.allRows){for(currKey in this.rowData.allRows){currRow=this.rowData.allRows[currKey];if(currRow.type=='i'&&currRow.val==value){ret.push(currRow);}}}return ret;},GetActivatedKey:function(){return this.activatedKey;},ForEachRow:function(actionFunc){var currKey,currRow;if(this.rowData&&this.rowData.allRows){for(currKey in this.rowData.allRows){currRow=this.rowData.allRows[currKey];actionFunc(currRow);}}},ExpandAllTrees:function(){this.ForEachRow(function(currRow){if(currRow.type=='i'&&currRow.Expand){currRow.Expand();}});},CollapseAllTrees:function(){this.ForEachRow(function(currRow){if(currRow.type=='i'&&currRow.Collapse){currRow.Collapse();}});},Activate:function(key){if(key===undefined||key===null){key='';}key=key.toString();var row=this.GetRow(key);if(row){this.DeActivate();this.activatedKey=key;row.UpdateRowClass();var parent=row.Parent();while(parent!==null){parent.Expand();parent=parent.Parent();}}},DeActivate:function(){var activatedRow=this.GetRow(this.activatedKey);if(activatedRow){this.activatedKey='';activatedRow.UpdateRowClass();}},RegisterSearch:function(s){this.search=s;},Enable:function(){this.SetIsEnabled(true);},Disable:function(){this.SetIsEnabled(false);},SetIsEnabled:function(isEnabled){this.isEnabled=isEnabled;if(!this.cb_sa1){this.cb_sa1=UI.GetById(this.GetMappedId()+'_cb_sa1');}if(this.cb_sa1){this.cb_sa1.disabled=!isEnabled;}if(!this.cb_sa2){this.cb_sa2=UI.GetById(this.GetMappedId()+'_cb_sa2');}if(this.cb_sa2){this.cb_sa2.disabled=!isEnabled;}this.ForEachRow(function(row){if(row.cbObj){row.cbObj.disabled=!isEnabled;}});},SetDisabledState:function(state){this.SetIsEnabled(!state);},GetSelectedKeysForType:function(type){var underScoreIndex=-1;var ret=new Array();var currKey,currRow;if(this.rowData&&this.rowData.allRows){for(currKey in this.rowData.allRows){currRow=this.rowData.allRows[currKey];if(currRow.type==type&&currRow.IsSelected()){underScoreIndex=currKey.indexOf('_');if(underScoreIndex>=0&&underScoreIndex<currKey.length){currKey=currKey.substr(underScoreIndex+1);}ret.push(currKey);}}}return ret;},g_getRow:function(key){if(this.rowData&&this.rowData.allRows&&this.rowData.allRows[key]){return this.rowData.allRows[key];}return null;},GetRow:function(key){var row=this.GetRowByType(key,'i');if(row===null){row=this.GetRowByType(key,'g');}return row;},GetRowByType:function(key,type){if(this.rowData){if(this.rowData.allRows){var currKey;var currRow;var underScoreIndex;for(currKey in this.rowData.allRows){currRow=this.rowData.allRows[currKey];if(currRow.type==type){underScoreIndex=currKey.indexOf('_');if(underScoreIndex>=0&&underScoreIndex<currKey.length){currKey=currKey.substr(underScoreIndex+1);}if(key==currKey){return currRow;}}}}}return null;},g_sr:function(key){var row=this.g_getRow(key);this.SelectRow(row,row.cbObj.checked);},g_sd:function(key){var startRow=this.g_getRow(key);startRow.Expand();var currKey;var allSelected=true;for(currKey in startRow.rows){var currRow=startRow.rows[currKey];if(currRow.doChildSelection){if(!currRow.AllDescendantsSelected(true)){this.SelectRow(currRow,true);allSelected=false;}}else{if(!currRow.IsSelected()){this.SelectRow(currRow,true);allSelected=false;}}}if(allSelected){for(currKey in startRow.rows){var currRow=startRow.rows[currKey];this.SelectRow(currRow,false);}}},RemoveRow:function(key){var row=this.GetRow(key);if(row===null){return;}var me=this;var myAnim=new YAHOO.util.Anim(row.obj,{opacity:{to:0}},0.5,YAHOO.util.Easing.easeOut);myAnim.onComplete.subscribe(function(){WindowEventManager.BubbleRemoveEvent(row.obj);var table=me.IDomNode;if(table){table.deleteRow(row.obj.rowIndex);if(row.dObj){table.deleteRow(row.dObj.rowIndex);}}if(me.rowData){me.rowData.RemoveRow(row);}});myAnim.animate();},SelectAll:function(){this.g_sa(true);},UnSelectAll:function(){this.g_sa(false);},g_sa:function(doSelect){var cbArr=UI.GetByName(this.GetMappedId()+'_cb_sa');if(cbArr.checked!==undefined){cbArr.checked=doSelect;}else if(cbArr.length==2){cbArr[0].checked=doSelect;cbArr[1].checked=doSelect;}var innerRow;var key;for(key in this.rowData.rows){innerRow=this.rowData.rows[key];this.SelectRow(innerRow,doSelect);}},g_te:function(key){var group=this.g_getRow(key);if(group.isExpanded){group.Collapse();}else{group.Expand();}},SelectRow:function(row,doSelect){var key;if(row.type=='i'){if(row.HasSelection()){if(!this.SelectionAllowMultiple()&&doSelect){var me=this;this.ForEachRow(function(eachRow){if(eachRow.IsSelected()){me.SelectRow(eachRow,false);}});}row.cbObj.checked=doSelect;row.isSelected=doSelect;row.UpdateRowClass();if(!doSelect){var group=row.m_parentGroup;while(group){if(group.hasSelection&&group.m_linkDescendantSelection){group.isSelected=false;group.cbObj.checked=false;}group=group.m_parentGroup;}}if(!doSelect){var theRow=row.m_parent;while(theRow){if(theRow.HasSelection()&&theRow.LinkDescendantSelection()){theRow.isSelected=false;theRow.cbObj.checked=false;theRow.UpdateRowClass();}theRow=theRow.m_parent;}}this.OnSelectRow.Trigger(row);}if(this.SelectionAllowMultiple()&&row.rows&&row.doChildSelection){for(key in row.rows){this.SelectRow(row.rows[key],doSelect);}}}else if(row.type=='g'){if(row.hasSelection){row.isSelected=doSelect;row.cbObj.checked=doSelect;}for(key in row.rows){this.SelectRow(row.rows[key],doSelect);}}},Init:function(){if(!this.data){return;}this.rowData=new D2L.GridRows(this);var count=this.data.length;var currElem;for(var i=0;i<count;i++){currElem=this.data[i];if(i+1<count){this.rowData.AddElem(currElem,this.data[i+1]);if(!D2L.Util.JavaScript.IsArray(currElem)&&currElem.charAt(0)==this.rowData.item){i++;}}else{this.rowData.AddElem(currElem);}this.m_rowIndex++;}var tableElement=this.GetDomNode();var table=this;const sortButtons=tableElement.querySelectorAll('d2l-table-col-sort-button');sortButtons.forEach(sortButton=>{if(sortButton.hasAttribute('data-haschildren')){sortButton.addEventListener('d2l-table-col-sort-button-item-change',e=>{const fieldName=e.target.getAttribute('data-fieldname');table.Sort(fieldName,!e.target.hasAttribute('data-desc'),true);});}else{const onClick=()=>{sortButton.removeEventListener('click',onClick);const field=sortButton.getAttribute('data-fieldname');const direction=sortButton.getAttribute('data-d2l-table-next-sort-dir');table.Sort(field,sortButton.hasAttribute('desc')||direction==='asc',true);};sortButton.addEventListener('click',onClick);}});if(!tableElement.classList.contains('d2l-grid-sticky'))return;const dropdownNodes=tableElement.querySelectorAll('.d2l-contextmenu-ph-dropdown');for(let i=0;i<dropdownNodes.length;i++){dropdownNodes[i].addEventListener('click',function(){if(window.innerWidth<768)return;const openNodes=document.querySelectorAll('.d2l-table-dropdown-open');for(let j=0;j<openNodes.length;j++){openNodes[j].classList.remove('d2l-table-dropdown-open');}this.parentNode.classList.add('d2l-table-dropdown-open');});}},Sort:function(fldName,isAsc,doReload){if(fldName!=this.sortField){this.pageNum=1;}this.sortFieldForState=fldName;this.sortField=fldName;if(isAsc){this.sortDirForState=1;this.sortDir=1;}else{this.sortDirForState=2;this.sortDir=2;}if(doReload){Nav.Go(new D2L.NavInfo());}},SetPageNum:function(pageNum,doReload){var origPageNum=this.pageNum;var me=this;var Set=function(){me.pageNum=pageNum;if(me.m_slPgNm1){me.m_slPgNm1.SelectOption(me.m_slPgNm1.GetOption(pageNum),false);}if(me.m_slPgNm2){me.m_slPgNm2.SelectOption(me.m_slPgNm2.GetOption(pageNum),false);}};if(doReload){if(me.m_slPgNm1){me.m_slPgNm1.SelectOption(me.m_slPgNm1.GetOption(origPageNum),false);}if(me.m_slPgNm2){me.m_slPgNm2.SelectOption(me.m_slPgNm2.GetOption(origPageNum),false);}var ni=new D2L.NavInfo();ni.OnNavigate.RegisterMethod(function(){Set();me.OnPageNumberChange.Trigger(pageNum);});Nav.Go(ni);}else{Set();}},SetPageSize:function(pageSize,doReload){var origPageSize=this.pageSize;var me=this;var Set=function(){me.pageSize=pageSize;me.pageNum=1;if(me.m_slPgSz1){me.m_slPgSz1.SelectOption(me.m_slPgSz1.GetOption(pageSize),false);}if(me.m_slPgSz2){me.m_slPgSz2.SelectOption(me.m_slPgSz2.GetOption(pageSize),false);}};if(doReload){if(me.m_slPgSz1){me.m_slPgSz1.SelectOption(me.m_slPgSz1.GetOption(origPageSize),false);}if(me.m_slPgSz2){me.m_slPgSz2.SelectOption(me.m_slPgSz2.GetOption(origPageSize),false);}var ni=new D2L.NavInfo();ni.OnNavigate.RegisterMethod(function(){Set();me.OnPageSizeChange.Trigger(pageSize);});Nav.Go(ni);}else{Set();}},GetSearch:function(){return this.search;},OnSearchChanged:function(sender){this.pageNum=1;},OnNav:function(navInfo){if(navInfo&&navInfo.IsAction()){var valNode=UI.GetById(this.GetMappedId()+'_values');while(valNode.hasChildNodes()){D2L.Util.Dom.Purge(valNode.childNodes[0]);valNode.removeChild(valNode.childNodes[0]);}var currRow;if(this.rowData&&this.rowData.allRows){for(var currKey in this.rowData.allRows){currRow=this.rowData.allRows[currKey];if(currRow.type=='i'&&currRow.IsSelected()&&currRow.val!==''){var hdn=document.createElement('input');hdn.type='hidden';hdn.name=this.nameOrMappedId+'_vals';hdn.value=currRow.val;valNode.appendChild(hdn);}}}}return true;},SelectionAllowMultiple:function(){return this.m_selectionAllowMultiple;},GetTreeType:function(){return this.m_treeType;}});D2L.Grid=D2L.Control.Grid;D2L.Control.Grid.Type={Data:1,List:2,NoLines:3};D2L.Grid.TreeType={StructureOnly:1,StructureHierarchy:2,StructureHierarchyLines:3};D2L.GridRows=D2L.Class.extend({Construct:function(g){arguments.callee.$.Construct.call(this);this.item='i';this.details='d';this.header='h';this.group='g';this.summary='s';this.grid=g;this.rows=new Array();this.allRows=new Array();this.treeNodePeekIndex=-1;this.openTreeNodes=new Array();this.groupPeekIndex=-1;this.openGroups=new Array();},PeekGroup:function(){if(this.groupPeekIndex<0){return null;}else{return this.openGroups[this.groupPeekIndex];}},PushGroup:function(group){this.groupPeekIndex++;this.openGroups[this.groupPeekIndex]=group;},PopGroup:function(){this.groupPeekIndex--;},PeekItemTreeNode:function(){if(this.treeNodePeekIndex<0){return null;}else{return this.openTreeNodes[this.treeNodePeekIndex];}},PushItemTreeNode:function(group){this.treeNodePeekIndex++;this.openTreeNodes[this.treeNodePeekIndex]=group;},PopItemTreeNode:function(){this.treeNodePeekIndex--;},AddRow:function(row){var currGroup=this.PeekGroup();if(currGroup){currGroup.AddRow(row);}else{this.rows[row.key]=row;}if(row.type==this.item){var currTreeNode=this.PeekItemTreeNode();if(currTreeNode){currTreeNode.AddRow(row);}}this.allRows[row.key]=row;},RemoveRow:function(row){var currKey,currRow;var newAllRows=new Array();for(currKey in this.allRows){currRow=this.allRows[currKey];if(currRow.key!=row.key){newAllRows[currKey]=currRow;}}this.allRows=newAllRows;var newRows=new Array();for(currKey in this.rows){currRow=this.rows[currKey];if(currRow.type==this.group){currRow.RemoveRow(row);}else if(currRow!=row){newRows[currKey]=currRow;}}this.rows=newRows;},AddElem:function(elem,extra){var type;if(D2L.Util.JavaScript.IsArray(elem)){type=elem[0].charAt(0);var groupElem=elem[0];groupElem=groupElem.substring(1,groupElem.length);var start=1;if(type==this.group){this.OpenGroup(groupElem);}else if(type==this.item){this.OpenItemTreeNode(groupElem,elem[1]);start++;}var len=elem.length;for(var i=start;i<len;i++){this.grid.m_rowIndex++;if(i+1<len){this.AddElem(elem[i],elem[i+1]);if(!D2L.Util.JavaScript.IsArray(elem[i])&&elem[i].charAt(0)==this.item){i++;}}else{this.AddElem(elem[i]);}}if(type==this.group){this.CloseGroup();}else if(type==this.item){this.CloseItemTreeNode();}}else{type=elem.charAt(0);var rest=elem.substring(1,elem.length);if(type==this.item){this.AddItem(rest,extra);}else if(type==this.header){this.AddHeader(rest);}else if(type==this.summary){this.AddSummary(rest);}}},AddHeader:function(elem){var row=new D2L.GridRow();var key=elem;row.grid=this.grid;row.type=this.header;row.key='h_'+key;row.obj=row.grid.GetDomNode().rows[row.grid.m_rowIndex];this.AddRow(row);},AddSummary:function(elem){var row=new D2L.GridRow();var key=elem;row.type=this.summary;row.key='s_'+key;row.obj=this.grid.IDomNode.rows[this.grid.m_rowIndex];this.AddRow(row);},OpenItemTreeNode:function(elem,extra){var row=this.AddItem(elem,extra);row.rows=new Array();row.isTreeNode=true;if(elem.charAt(2)=='0'){row.isExpanded=false;}else{row.isExpanded=true;}if(elem.charAt(4)=='0'){row.isChild=false;}else{row.isChild=true;}row.hasChildren=elem.charAt(8)=='1';row.hasSiblings=elem.charAt(9)=='1';row.isTopLevel=elem.charAt(10)=='1';row.isFirstSibling=elem.charAt(11)=='1';row.isLastSibling=elem.charAt(1)=='1';row.ExpandHelper=GridExpandHelper;row.CollapseHelper=GridCollapseHelper;row.SetVisibleHelper=GridRowSetVisible;row.SetVisible=function(isVisible){row.SetVisibleHelper(isVisible);};row.Expand=function(){this.isExpanded=true;this.SetTreeNodeImage();this.ExpandHelper();if(navigator.userAgent.indexOf("MSIE")==-1){this.SetVisible(false);this.SetVisible(true);}};row.Collapse=function(){this.isExpanded=false;this.SetTreeNodeImage();this.CollapseHelper();};row.SetTreeNodeImage=function(){if(this.treObj){var oldImg=this.treObj.childNodes[0];var oldImgSrc=oldImg.src;var t=this.isTopLevel&&!this.isFirstSibling?'t':'';var r='r';var b='';var l=!this.isTopLevel?'l':'';var imageTerm='';var langTerm='';if(this.isExpanded){b=this.hasChildren?'b':'';imageTerm='Framework.Grid.actCollapse';langTerm='Framework.Grid.altCollapseRow';}else{b=this.isTopLevel&&this.hasSiblings?'b':'';imageTerm='Framework.Grid.actExpand';langTerm='Framework.Grid.altExpandRow';}D2L.Images.ImageTerm.Assign(imageTerm,oldImg);var lang=new D2L.LP.Text.LangTerm(langTerm);lang.SetSubject(this.m_subject);lang.AssignText(oldImg,'title');lang.AssignText(oldImg,'alt');if(this.grid.GetTreeType()==D2L.Grid.TreeType.StructureHierarchyLines){var className='d_g_l_'+t+r+b+l;this.treObj.parentNode.parentNode.className=className;}}};row.AddRow=function(row){row.m_parent=this;this.rows[row.key]=row;};for(var i=0;i<row.obj.cells.length;i++){if(row.obj.cells[i].firstChild){if(row.obj.cells[i].firstChild.className=='d_gt'){row.treObj=row.obj.cells[i].firstChild.firstChild;break;}else if(row.obj.cells[i].firstChild.className=='d_gts'){row.treObj=row.obj.cells[i].firstChild;break;}}}this.PushItemTreeNode(row);},CloseItemTreeNode:function(){this.PopItemTreeNode();},AddItem:function(elem,extra){var row=new D2L.GridRow();row.type=this.item;row.grid=this.grid;row.m_subject=extra[0];row.val=extra[1];if(elem.charAt(0)=='1'){row.hasSelection=true;}else{row.hasSelection=false;}if(elem.charAt(1)=='1'){row.hasDetails=true;}else{row.hasDetails=false;}if(elem.charAt(3)=='1'){row.isSelected=true;}else{row.isSelected=false;}if(elem.charAt(5)=='1'){row.doChildSelection=true;}else{row.doChildSelection=false;}if(elem.charAt(6)=='1'){row.isAlt=true;}else{row.isAlt=false;}row.m_linkDescendantSelection=elem.charAt(13)=='1';var index1=elem.indexOf('_');var index2=elem.lastIndexOf('_');var key=elem.substring(index1+1,index2);row.key=key;row.obj=row.grid.GetDomNode().rows[row.grid.m_rowIndex];this.AttachObject(row.obj,'rowObj',row);if(row.hasSelection){for(var i=0;i<row.obj.cells.length;i++){if(row.obj.cells[i].firstChild&&row.obj.cells[i].firstChild.name&&row.obj.cells[i].firstChild.name==this.grid.nameOrMappedId+'_cb'){row.cbObj=row.obj.cells[i].firstChild;break;}}}if(row.hasDetails){row.dObj=row.obj.nextSibling;row.grid.m_rowIndex++;}var showChangesFlag=elem.charAt(7);if(showChangesFlag=='2'){row.HandleOnChange(new D2L.ChangeEvent(row.obj));}else if(showChangesFlag=='1'){this.AttachObject(row.obj,'ID2LOnChange',new D2L.EventHandler());row.obj.ID2LOnChange.Register(row,'HandleOnChange');}for(var i=index2+1;i<elem.length;i+=2){var showChanges=elem.charAt(i);if(showChanges=='1'){var cellIndex=(i-(index2+1))/2;var hasChanged=elem.charAt(i+1);if(hasChanged=='1'){row.HandleCellOnChange(new D2L.ChangeEvent(row.obj.cells[cellIndex]));}else{this.AttachObject(row.obj.cells[cellIndex],'ID2LOnChange',new D2L.EventHandler());row.obj.cells[cellIndex].ID2LOnChange.Register(row,'HandleCellOnChange');}}}if(row.IsSelected()){row.UpdateRowClass();}this.AddRow(row);return row;},OpenGroup:function(elem){var row=new D2L.GridGroup();if(elem.charAt(0)=='1'){row.hasSelection=true;}if(elem.charAt(1)=='0'){row.isExpanded=false;}if(elem.charAt(2)=='1'){row.m_linkDescendantSelection=true;}var key=elem.substring(3,elem.length);row.type=this.group;row.key=key;row.obj=this.grid.IDomNode.rows[this.grid.m_rowIndex];row.cbObj=UI.GetById(this.grid.GetMappedId()+'_cb'+key);row.exObj=UI.GetById(this.grid.GetMappedId()+'_ex'+key);this.AddRow(row);this.PushGroup(row);},CloseGroup:function(){this.PopGroup();}});D2L.GridRow=D2L.Class.extend({Construct:function(){arguments.callee.$.Construct.call(this);this.m_isDeleted=false;this.grid=null;this.hasChanged=false;this.changedCells=[];this.m_hiddenChanged=null;this.m_hiddenDeleted=null;this.val='';this.m_parentGroup=null;this.m_parent=null;this.isSelected=false;this.m_initialClass=null;this.m_linkDescendantSelection=false;this.m_hasSpecifiedKey=false;this.m_subject='';FormManager.OnChangeReset.Register(this,'HandleOnChangeReset');},GetSubject:function(){return this.m_subject;},LinkDescendantSelection:function(){return this.m_linkDescendantSelection;},HasSelection:function(){return this.hasSelection;},UpdateRowClass:function(){if(this.m_initialClass===null){this.m_initialClass=this.obj.className;}var isActivated=this.grid.activatedKey.length>0&&this.GetKey().length>0&&this.grid.activatedKey==this.GetKey();if(isActivated){this.obj.classList.add('d_ga');D2L.LP.Web.UI.Html.Dom.SetAttribute(this.obj,'active','');}else{this.obj.classList.remove('d_ga');D2L.LP.Web.UI.Html.Dom.RemoveAttribute(this.obj,'active');}if(this.hasChanged){this.obj.classList.add('d_gc');}else{this.obj.classList.remove('d_gc');}if(this.IsSelected()){this.obj.classList.add('d_gs');D2L.LP.Web.UI.Html.Dom.SetAttribute(this.obj,'selected','');if(this.hasDetails){this.dObj.classList.add('d_gs');D2L.LP.Web.UI.Html.Dom.SetAttribute(this.dObj,'selected','');}}else{this.obj.classList.remove('d_gs');D2L.LP.Web.UI.Html.Dom.RemoveAttribute(this.obj,'selected');if(this.hasDetails){this.dObj.classList.remove('d_gs');D2L.LP.Web.UI.Html.Dom.RemoveAttribute(this.dObj,'selected');}}if(this.IsDeleted()){this.obj.classList.add('d_gdel');}else{this.obj.classList.remove('d_gdel');}},SetTextFormat:function(format){var f=format.toLowerCase();var oldClass=this.obj.className;if(f=='normal'){if(oldClass.indexOf('d_dbold')>=0){this.obj.className=oldClass.replace('d_dbold','');if(this.m_initialClass){this.m_initialClass=this.m_initialClass.replace('d_dbold','');}}}else if(f=='bold'){if(oldClass.indexOf('d_dbold')<0){this.obj.className+=' d_dbold';if(this.m_initialClass){this.m_initialClass+=' d_dbold';}}}},SetIsUnread:function(value){var oldClass=this.obj.className;if(value&&oldClass.indexOf('d2l-grid-row-unread')<0){this.obj.className+=' d2l-grid-row-unread';if(this.m_initialClass){this.m_initialClass+=' d2l-grid-row-unread';}}else if(oldClass.indexOf('d2l-grid-row-unread')>=0){this.obj.className=oldClass.replace('d2l-grid-row-unread','');if(this.m_initialClass){this.m_initialClass=this.m_initialClass.replace('d2l-grid-row-unread','');}}},HandleOnChange:function(event){if(!event.hasChangeBeenShown){if(!this.hasChanged){this.hasChanged=true;this.UpdateRowClass();}event.hasChangeBeenShown=true;}if(this.m_hiddenChanged===null){this.m_hiddenChanged=document.createElement('input');this.m_hiddenChanged.type='hidden';this.m_hiddenChanged.value=this.GetKey();this.obj.firstChild.appendChild(this.m_hiddenChanged);}this.m_hiddenChanged.name=this.grid.nameOrMappedId+'_ckeys';},HandleCellOnChange:function(event){if(!event.hasChangeBeenShown){var node=event.source;var prevNode=null;while(node!=this.obj){prevNode=node;node=node.parentNode;}this.hasChanged=true;this.changedCells[prevNode.cellIndex]=true;prevNode.className+=' d_gch';}},HandleOnChangeReset:function(){this.hasChanged=false;this.UpdateRowClass();},HasSpecifiedKey:function(){return this.m_hasSpecifiedKey;},GetKey:function(){var underScoreIndex=this.key.indexOf('_');if(underScoreIndex>=0&&underScoreIndex<this.key.length){return this.key.substr(underScoreIndex+1);}return'';},GetValue:function(){return this.val;},SetVisible:GridRowSetVisible,Delete:function(){if(!this.IsDeleted()){if(this.m_hiddenDeleted===null){this.m_hiddenDeleted=document.createElement('input');this.m_hiddenDeleted.type='hidden';this.m_hiddenDeleted.value=this.GetKey();this.obj.firstChild.appendChild(this.m_hiddenDeleted);}this.m_hiddenDeleted.name=this.grid.nameOrMappedId+'_dkeys';this.m_isDeleted=true;this.UpdateRowClass();WindowEventManager.BubbleChangeEvent(this.obj);this.grid.OnDeleteRow.Trigger(this);}},IsDeleted:function(){return this.m_isDeleted;},IsSelected:function(){return this.isSelected;},HasSelectedDescendant:function(considerRootNode){if(considerRootNode&&this.IsSelected()){return true;}for(var currKey in this.rows){var currRow=this.rows[currKey];if(currRow.HasSelectedDescendant(true)){return true;}}return false;},AllDescendantsSelected:function(considerRootNode){if(considerRootNode&&!this.IsSelected()){return false;}for(var currKey in this.rows){var currRow=this.rows[currKey];if(!currRow.AllDescendantsSelected(true)){return false;}}return true;},Restore:function(){if(this.IsDeleted()){this.m_hiddenDeleted.name='';this.m_isDeleted=false;this.UpdateRowClass();this.grid.OnRestoreRow.Trigger(this);}},SetIsDeleted:function(isDeleted){if(!this.IsDeleted()&&isDeleted){this.Delete();}else if(this.IsDeleted()&&!isDeleted){this.Restore();}},ToggleIsDeleted:function(){this.SetIsDeleted(!this.IsDeleted());},SetDoChildSelection:function(doChildSelection){this.doChildSelection=doChildSelection;},DoChildSelection:function(){return this.doChildSelection;},Parent:function(){return this.m_parent;},SetBackgroundColour:function(colour){var row=this.obj;row.style.backgroundColor=colour;},GetCellByIndex:function(index){var cells=this.obj.getElementsByTagName("td");for(var i=0;i<cells.length;i++){var cell=cells[i];if(cell.parentNode==this.obj){if(index==0){return cell;}else{index--;}}}return null;},SetCellBackgroundColour:function(index,colour){var cell=this.GetCellByIndex(index);cell.style.backgroundColor=colour;},SetCellOnMouseOver:function(index,func){var cell=this.GetCellByIndex(index);cell.onmouseover=func;},SetCellOnMouseOut:function(index,func){var cell=this.GetCellByIndex(index);cell.onmouseout=func;},SetCellOnMouseClick:function(index,func){var cell=this.GetCellByIndex(index);cell.onclick=func;},SetCellProperty:function(index,propName,propValue){var cell=this.GetCellByIndex(index);cell[propName]=propValue;}});D2L.GridGroup=D2L.Class.extend({Construct:function(){arguments.callee.$.Construct.call(this);this.rows=new Array();this.doChildSelection=true;this.itemRows=new Array();this.m_linkDescendantSelection=false;this.m_parentGroup=null;this.isSelected=false;},SetVisible:GridRowSetVisible,ExpandHelper:GridExpandHelper,CollapseHelper:GridCollapseHelper,Expand:function(){if(this.exObj){this.exObj.innerHTML='<img style=\"border:none;\" src=\"/d2l/tools/img/up.gif\" width=\"6\" height=\"8\" alt=\"Collapse Group\" title=\"Collapse Group\" />';}this.isExpanded=true;this.ExpandHelper();},Collapse:function(){if(this.exObj){this.exObj.innerHTML='<img style=\"border:none;\" src=\"/d2l/tools/img/down.gif\" width=\"6\" height=\"8\" alt=\"Expand Group\" title=\"Expand Group\" />';}this.isExpanded=false;this.CollapseHelper();},AddRow:function(row){row.m_parentGroup=this;this.rows[row.key]=row;},IsSelected:function(){return this.isSelected;},RemoveRow:function(row){var newRows=new Array();for(currKey in this.rows){currRow=this.rows[currKey];if(currRow.type==this.group){currRow.RemoveRow(row);}else if(currRow!=row){newRows[currKey]=currRow;}}this.rows=newRows;}});function GridExpandHelper(){for(var key in this.rows){var row=this.rows[key];row.SetVisible(true);if(row.obj.classList.contains('d_lastRow')){this.obj.classList.remove('d_lastRow');}if(row.type==='g'||row.type==='i'&&row.rows){if(row.isExpanded){row.ExpandHelper();}}}WindowEventManager.Transform.Trigger();}function GridCollapseHelper(){for(var key in this.rows){var row=this.rows[key];row.SetVisible(false);if(row.type==='g'||row.type==='i'&&row.rows){row.CollapseHelper();}if(row.obj.classList.contains('d_lastRow')){this.obj.classList.add('d_lastRow');}}WindowEventManager.Transform.Trigger();}function GridRowSetVisible(isVisible){this.isVisible=isVisible;D2L.LP.Web.UI.Html.Dom.ToggleClassName('d_g_display_none',this.obj,!isVisible);}function GridRemoveErrorBalloon(balloon,resizeFunction){if(resizeFunction!==null&&resizeFunction!==undefined){window.removeEventListener("resize",resizeFunction);}if(balloon!==null&&balloon!==undefined&&balloon.lastChild.className.indexOf("vui-validation-bubble-hide")<0){balloon.lastChild.className+=" vui-validation-bubble-hide";setTimeout(function(){if(balloon!==null&&balloon!==undefined&&balloon.parentNode!==null&&balloon.parentNode!==undefined){balloon.parentNode.removeChild(balloon);}},200);}}function GridActionErrorHandler(event,primaryMessage,secondaryMessage){if(event===null||event===undefined||event&&event.type==='d2l-button-ghost-click'){if(secondaryMessage)UI.Error(primaryMessage,secondaryMessage);else UI.Error(primaryMessage);return;}var gridContainer=event.target||event.srcElement;while(gridContainer!==null&&gridContainer!==undefined&&(gridContainer=gridContainer.parentElement)&&gridContainer.className.indexOf("d2l-grid-container")<0){}if(gridContainer===null||gridContainer===undefined||gridContainer.querySelector("tr[selected]")!==null&&gridContainer.querySelector("tr[selected]")!==undefined){return;}var balloons=gridContainer.querySelector(".vui-validation-bubble-show");if(balloons!==null&&balloons!==undefined){if(balloons.constructor!==Array){GridRemoveErrorBalloon(balloons);}else{for(var i=0;i<balloons.length;i++){GridRemoveErrorBalloon(balloons[i]);}}}var buttonAnchor=event.target||event.srcElement;var isChomped=typeof buttonAnchor.getAttribute('data-is-chomped')==='string';if(isChomped){var overflowGroup=gridContainer.querySelector('d2l-overflow-group');buttonAnchor=overflowGroup.shadowRoot.querySelector('.d2l-overflow-dropdown')||overflowGroup.shadowRoot.querySelector('.d2l-overflow-dropdown-mini');}while(buttonAnchor!=undefined&&buttonAnchor.tagName!=="A"&&buttonAnchor.tagName!=="D2L-BUTTON-SUBTLE"&&buttonAnchor.tagName!=="D2L-BUTTON-ICON"&&!isChomped){buttonAnchor=buttonAnchor.parentElement;}if(buttonAnchor===null||buttonAnchor===undefined){return;}var container=gridContainer.querySelector(".d2l-grid-actions-container");GridActionErrorBalloon(buttonAnchor,container);}function GridActionErrorBalloonResize(balloon,buttonAnchor,container){var hoverTarget=buttonAnchor;if(buttonAnchor.style.display==="none"){hoverTarget=container.querySelector("d2l-buttons-menu");}var balloonDiv=balloon.lastChild;var left=hoverTarget.offsetLeft+hoverTarget.offsetWidth/2.0-balloonDiv.offsetWidth/2.0;if(left<0){left=hoverTarget.offsetLeft+hoverTarget.offsetWidth/2.0-34;if(balloonDiv.className.indexOf("vui-validation-bubble-left")<0){balloonDiv.className+=" vui-validation-bubble-left";}}else if(left+balloonDiv.offsetWidth>container.offsetWidth){left=left-balloonDiv.offsetWidth/2.0+34;if(balloonDiv.className.indexOf("vui-validation-bubble-right")<0){balloonDiv.className+=" vui-validation-bubble-right";}}else{balloonDiv.className=balloonDiv.className.replace("vui-validation-bubble-left","");balloonDiv.className=balloonDiv.className.replace("vui-validation-bubble-right","");}if(document.body.dir==="rtl"){left=left-container.offsetWidth+balloonDiv.offsetWidth;}balloonDiv.style.left=left+"px";}function GridActionErrorBalloon(buttonAnchor,container){if(buttonAnchor===undefined||buttonAnchor===null||container===undefined||container===null){return;}var balloon=D2L.Validation.CreateErrorBalloon(new D2L.Language.Term("Classlist.classlist.jsNoItemSelectedSecondary"));balloon.lastChild.setAttribute("role","alert");container.insertBefore(balloon,container.firstChild);var resizeFunction=function(){GridActionErrorBalloonResize(balloon,buttonAnchor,container);};window.addEventListener("resize",resizeFunction);GridActionErrorBalloonResize(balloon,buttonAnchor,container);setTimeout(function(){GridRemoveErrorBalloon(balloon,resizeFunction);},3000);}